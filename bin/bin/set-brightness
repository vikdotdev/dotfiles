#!/bin/bash

# Author: Viktor Habchak <vikdotdev@gmail.com>
#
# Description:
# Change xrandr brightness with +10% or -5%.
# WARNING: not working well - it's laggy

function set-brightness {
  xrandr --output "$CONNECTED_SCREEN" --brightness "$1"
}

SIGN=$(echo "$1" | head -c 1)
VALUE=$(echo $1 | head -c 5 | cut -d '+' -d '-' -f2 | cut -d '%' -f1)
UPPER_BOUND=1.0
CURRENT_VALUE=$(xrandr --prop --verbose | grep -A10 " connected" | grep "Brightness" | cut -d' ' -f2)
CHANGE_BY=$(echo "$(echo +10% | head -c 5 | cut -d '+' -f2 | cut -d '%' -f1) / 100" | bc -l)
NEW_VALUE=$(echo "$CURRENT_VALUE $SIGN $CHANGE_BY" | bc -l)
CONNECTED_SCREEN=$(xrandr --prop --verbose  | grep -i " connected" | cut -d ' ' -f 1)

if [ "$SIGN" = '+' ]; then
  if (( $(echo "$NEW_VALUE < $UPPER_BOUND" | bc -l) )); then
    set-brightness $NEW_VALUE
  else
    set-brightness $UPPER_BOUND
  fi
elif [ "$SIGN" = '-' ]; then
  set-brightness $NEW_VALUE
fi
