#!/bin/bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOT_HOME="$(dirname "$(dirname "$(dirname "$SCRIPT_DIR")")")"

source "$DOT_HOME/lib/debian/include.sh"

MODULE="mise"
init_module_logging "$MODULE"

log_header "Building Mise Configuration"

if command_exists mise; then
    log_step "Creating mise.toml"
    mkdir -p "$HOME/.config/mise/"
    cp "$SCRIPT_DIR/config/mise.toml" "$HOME/.config/mise/config.toml"
    log_success "Deployed mise config to ~/.config/mise/config.toml"
    log_step "Installing tools"
    mise install
    finalize_module_logging "success"
else
    log_error "mise build failed - mise binary not found"
    exit 0
fi

