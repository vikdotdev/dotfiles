#!/bin/bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOT_HOME="$(dirname "$(dirname "$(dirname "$SCRIPT_DIR")")")"

source "$DOT_HOME/lib/debian/include.sh"

MODULE="emacs"
init_module_logging "$MODULE"

log_header "Building Emacs Configuration"

# Deploy Emacs configuration
log_step "Deploying Emacs configuration"

EMACS_CONFIG_DIR="$HOME/.config/emacs"
mkdir -p "$EMACS_CONFIG_DIR"

if [[ -f "$SCRIPT_DIR/config/init.el" ]]; then
    copy_file "$SCRIPT_DIR/config/init.el" "$EMACS_CONFIG_DIR/init.el"
    log_info "Deployed init.el"
fi

if [[ -f "$SCRIPT_DIR/config/config.org" ]]; then
    copy_file "$SCRIPT_DIR/config/config.org" "$EMACS_CONFIG_DIR/config.org"
    log_info "Deployed config.org"
fi

log_success "Emacs configuration completed"
finalize_module_logging "success"
