#!/bin/bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOT_HOME="$(dirname "$(dirname "$SCRIPT_DIR")")"

source "$DOT_HOME/lib/debian/include.sh"

MODULE="desktop"
init_module_logging "$MODULE"

log_header "Installing Desktop Applications (Flatpak-only)"

# All desktop GUI applications via Flatpak for stability
# No custom repositories - only official Flathub
DESKTOP_APPS=(
    "com.spotify.Client"                        # Spotify
    "com.slack.Slack"                           # Slack
    "com.discordapp.Discord"                    # Discord
    "org.telegram.desktop"                      # Telegram
    "org.gnome.Solanum"                         # Solanum (Pomodoro timer)
    "com.rafaelmardojai.Blanket"                # Blanket (Background sounds)
    "com.rtosta.zapzap"                         # ZapZap (WhatsApp)
    "io.gitlab.adhami3310.Impression"           # Impression (USB writer)
    "com.mattjakeman.ExtensionManager"          # Extension Manager
    "io.github.zen_browser.zen"                 # Zen Browser
)

log_step "Installing desktop applications via Flatpak"

for app in "${DESKTOP_APPS[@]}"; do
    log_info "Installing $app"
    install_flatpak "$app" || log_warning "Failed to install $app (may not exist in Flathub)"
done

log_success "Desktop applications installation completed"


finalize_module_logging "success"
