#!/bin/bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOT_HOME="$(dirname "$(dirname "$(dirname "$SCRIPT_DIR")")")"

source "$DOT_HOME/lib/debian/include.sh"

MODULE="1password"
init_module_logging "$MODULE"

log_header "Installing 1Password"

# Check if 1Password is already installed (Flatpak)
if flatpak info com.1password.1Password &>/dev/null; then
    log_info "1Password is already installed"
    log_success "1Password installation completed"
    finalize_module_logging "success"
    exit 0
fi

flatpak install -y --noninteractive --user --or-update \
  https://downloads.1password.com/linux/flatpak/1Password.flatpakref

log_success "1Password installation completed"
finalize_module_logging "success"
